<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.taikang.health.iams.dao.AutzResourceDao">

    <resultMap id="AutzResourceResultMap" type="com.taikang.health.iams.po.AutzResourcePO">
        <id property="id" column="resource_id" javaType="String" jdbcType="VARCHAR"/>
        <result property="resourceCode" column="resource_code" javaType="String" jdbcType="VARCHAR"/>
        <result property="resourceName" column="resource_name" javaType="String" jdbcType="VARCHAR"/>
        <result property="module" column="module" javaType="String" jdbcType="VARCHAR"/>
        <result property="parentId" column="parent_id" javaType="String" jdbcType="VARCHAR"/>
        <result property="uri" column="uri" javaType="String" jdbcType="VARCHAR"/>
        <result property="type" column="type" javaType="Integer" jdbcType="SMALLINT"/>
        <result property="status" column="status" javaType="Integer" jdbcType="SMALLINT"/>
        <result property="createTime" column="create_time" javaType="Date" jdbcType="DATE"/>
        <result property="updateTime" column="update_time" javaType="Date" jdbcType="DATE"/>
    </resultMap>

    <!---========================自定义查询放置下方========================-->
    <!--自定义查询 查询用户拥有的资源信息-->
    <select id="listResources" parameterType="java.lang.String" resultMap="AutzResourceResultMap">
        SELECT a.*
        FROM autz_resource a
          LEFT JOIN autz_role_resource b  ON a.`resource_id` = b.`resource_id`
          LEFT JOIN autz_role c           ON c.`role_id` = b.`role_id`
          LEFT JOIN autz_user_role d      ON c.`role_id` = d.`role_id`
          LEFT JOIN autz_user e           ON e.`user_id` = d.`user_id`
        WHERE e.`user_id` = #{userId}
          AND e.`enable` = 1
          AND c.`status` = 1
          AND a.`status` = 1

    </select>


    <select id="roleResources" parameterType="java.lang.String" resultMap="AutzResourceResultMap">
        SELECT e.*
        FROM autz_role c
          INNER JOIN autz_role_resource d ON c.`role_id` = d.`role_id`
          INNER JOIN autz_resource e      ON e.`resource_id` = d.`resource_id`
        WHERE c.`role_id` = #{roleId}
          AND e.`status` = 1
          AND c.`status` = 1

    </select>

    <select id="menuResourcesByUid" parameterType="java.lang.String" resultMap="AutzResourceResultMap">
        SELECT DISTINCT d.*
        FROM autz_user a
          INNER JOIN autz_user_role b        ON a.`user_id` = b.user_id
          INNER JOIN autz_role_resource c    ON b.role_id = c.role_id
          INNER JOIN autz_resource d         ON c.resource_id = d.`resource_id`
        WHERE a.`user_id` = #{userId}
          AND d.type = 1
          AND d.status = 1
          AND a.`enable` = 1

    </select>


</mapper>