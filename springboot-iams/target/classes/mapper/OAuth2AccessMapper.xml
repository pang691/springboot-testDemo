<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.taikang.health.iams.dao.OAuth2AccessDao">

    <resultMap id="OAuth2AccessResultMap" type="com.taikang.health.iams.po.OAuth2Access">
        <id property="id" column="access_id" javaType="string" jdbcType="VARCHAR"/>
        <result property="clientId" column="client_id" javaType="String" jdbcType="VARCHAR"/>
        <result property="userId" column="user_id" javaType="String" jdbcType="VARCHAR"/>
        <result property="accessToken" column="access_token" javaType="String" jdbcType="VARCHAR"/>
        <result property="refreshToken" column="refresh_token" javaType="String" jdbcType="VARCHAR"/>
        <result property="expireIn" column="expire_in" javaType="int" jdbcType="NUMERIC"/>
        <result property="refreshTokenValidity" column="refresh_token_validity" javaType="int" jdbcType="INTEGER"/>
        <result property="createDate" column="create_date" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
        <result property="accessTokenUpdateTime" column="access_token_update_time" javaType="java.util.Date" jdbcType="TIMESTAMP"/>
    </resultMap>

    <select id="selectByAccessToken" parameterType="string" resultMap="OAuth2AccessResultMap">
        select * from security_access where access_token=#{access_token}
    </select>

    <select id="selectByRefreshToken" parameterType="string" resultMap="OAuth2AccessResultMap">
        select * from security_access where refresh_token=#{refresh_token}
    </select>

    <select id="selectByUserId" parameterType="string" resultMap="OAuth2AccessResultMap">
        select * from security_access where user_id=#{userId}
    </select>

    <update id="updateByIdAndKeys">
        update security_access set
        access_token=#{token.accessToken},create_date=#{token.createDate},access_token_update_time=#{token.accessTokenUpdateTime}
        where access_id=#{token.id}
        <if test="params.accessToken!=null and params.accessToken !=''">
            and access_token=#{params.accessToken}
        </if>
    </update>


</mapper>